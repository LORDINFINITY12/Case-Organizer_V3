<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark">
  <script>
      (function () {
          try {
              const KEY = 'caseOrg.theme';
              const saved = localStorage.getItem(KEY);
              const wantsDark = saved ? (saved === 'dark')
                  : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
              const defaultDark = true;
              const useDark = saved ? (saved === 'dark') : defaultDark || wantsDark;
              if (useDark) document.documentElement.setAttribute('data-theme', 'dark');
          } catch (e) {}
      })();
  </script>
  <title>Case Organizer</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  <meta name="color-scheme" content="light dark">
</head>
<body>
  <div class="app-shell">
    <header class="topbar">
      <div class="brand">Case Organizer</div>
      <div class="spacer"></div>
      {% if current_user %}
        <a href="{{ url_for('account') }}" class="account-link" title="My Account">
          <i class="fa-solid fa-user"></i>
        </a>
        {% if current_user.role == 'admin' %}
          <a href="{{ url_for('admin_settings') }}" class="settings-link" title="Settings">
            <i class="fa-solid fa-gear"></i>
          </a>
        {% endif %}
      {% endif %}
      <div class="user">{{ current_user.email if current_user else 'Guest' }}</div>
      <button id="theme-toggle" class="theme-toggle" title="Toggle theme" aria-label="Toggle theme">
        <i class="fa-solid fa-moon"></i>
      </button>
      <a href="{{ url_for('logout') }}" class="logout" title="Logout">
        <i class="fa-solid fa-right-from-bracket"></i>
      </a>
    </header>

    <main class="home enter-animate">
      {% include "_flash.html" %}

      <!-- Search Bar -->
      <section class="search-section" aria-label="Search">
        <div class="search-row">
          <input id="search-q" type="text" placeholder="Search by file name or date…" aria-label="Search text" />
          <button id="search-btn" class="btn-primary" type="button" aria-label="Search">
            <i class="fa-solid fa-magnifying-glass"></i> Search
          </button>
        </div>

        <form id="adv-form" class="adv-form" hidden aria-label="Advanced Search">
          <input type="text" id="party" placeholder="Party Name" aria-label="Party Name" />
          <div class="year-dd" id="year-dd" data-start="2025">
              <input type="hidden" id="year" aria-label="Year" />
              <button type="button" class="yd-trigger" aria-haspopup="listbox" aria-expanded="false">
                  Year: 2025
              </button>
              <div class="yd-panel" role="listbox" hidden></div>
          </div>
          <select id="month" aria-label="Month">
            <option value="">Month</option>
            <option>Jan</option><option>Feb</option><option>Mar</option><option>Apr</option>
            <option>May</option><option>Jun</option><option>Jul</option><option>Aug</option>
            <option>Sep</option><option>Oct</option><option>Nov</option><option>Dec</option>
          </select>

          <select id="adv-domain" aria-label="Case Category">
            <option value="">Case Category</option>
            <option>Criminal</option>
            <option>Civil</option>
            <option>Commercial</option>
          </select>
          <select id="adv-subcat" aria-label="Subcategory" disabled>
            <option value="">Subcategory</option>
          </select>

          <button id="adv-search" class="btn-secondary" type="button">Run Detailed Search</button>
          <button id="dir-search" class="btn-ghost" type="button">Directory Search</button>

        </form>

        <div id="results" class="results" role="region" aria-live="polite"></div>
      </section>

      <!-- Big Boxes -->
      <section class="cards-grid" aria-label="Main Actions">
        <div id="card-create" class="card big selectable" role="button" tabindex="0" aria-pressed="false" aria-label="Create Case">
          <div class="icon"><i class="fa-solid fa-note-sticky"></i></div>
          <div class="label">Create Case</div>
        </div>
        <div id="card-manage" class="card big selectable" role="button" tabindex="0" aria-pressed="false" aria-label="Manage Case">
          <div class="icon"><i class="fa-solid fa-file-arrow-up"></i></div>
          <div class="label">Manage Case</div>
        </div>
        <div id="card-upload-case-law" class="card big selectable" role="button" tabindex="0" aria-pressed="false" aria-label="Upload Case Law">
          <div class="icon"><i class="fa-solid fa-gavel"></i></div>
          <div class="label">Upload Case Law</div>
        </div>
        <div id="card-search-case-law" class="card big selectable" role="button" tabindex="0" aria-pressed="false" aria-label="Search Case Law">
          <div class="icon"><i class="fa-solid fa-scale-balanced"></i></div>
          <div class="label">Search Case Law</div>
        </div>
      </section>

      <!-- Forms appear here -->
      <section id="form-host" aria-live="polite"></section>
    </main>
  </div>

  <!-- Global modal for Note.json view/edit -->
  <div class="modal" id="notesModal" hidden aria-hidden="true">
      <div class="modal-content">
      <div class="modal-head">
          <h3 id="notesTitle">Case Notes (Note.json)</h3>
          <button class="btn-ghost" id="notesClose" aria-label="Close">✕</button>
      </div>
      <textarea id="notesEditor" class="notes-editor" spellcheck="false"></textarea>
      <div class="modal-actions">
          <button id="editNotesBtn" class="btn-secondary">Edit</button>
          <button id="saveNotesBtn" class="btn-primary" hidden>Save</button>
          <button id="cancelNotesBtn" class="btn-ghost" hidden>Cancel</button>
      </div>
  </div>
</div>



  <!-- Global modal for Note.json addition -->

  <div class="modal" id="noteModal" hidden>
  <div class="modal-content">
    <div class="modal-head">
      <h3>Create Note.json</h3>
      <button class="btn-ghost" id="noteClose" aria-label="Close">✕</button>
    </div>
    <textarea id="noteContent" rows="10" style="width:100%;"></textarea>
    <div class="modal-actions">
      <button id="noteSave" class="btn-primary">Save</button>
    </div>
  </div>
</div>


  <!-- Delete confirmation modal -->
  <div class="modal" id="confirmModal" hidden aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <div class="modal-content">
      <div class="modal-head">
        <h3 id="confirmTitle">Confirm Delete</h3>
        <button class="btn-ghost" id="confirmClose" aria-label="Close">✕</button>
      </div>
      <div id="confirmText" style="padding: 6px 2px;">Do you want to delete this file?</div>
      <div class="modal-actions">
        <button id="confirmYes" class="btn-primary">Yes</button>
        <button id="confirmNo" class="btn-ghost">No</button>
      </div>
    </div>
  </div>


  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
